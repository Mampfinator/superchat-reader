<script defer>
    class ConfigBuilderSlider extends HTMLElement{
        connectedCallback() {
            const uuid = this.getAttribute("uuid")
            if (!uuid) {
                throw new Error("Custom slider must have a UUID")
            }
            const preLabel = document.createElement("label")
            const slider = document.createElement("input")
            const valLabel = document.createElement("label")
            const shadow = this.attachShadow({mode:"closed"})

            // Set this to a block element
            this.style.display = "block"

            // Text label setup
            preLabel.setAttribute("for", uuid)
            preLabel.innerText = this.getAttribute("label") ?? "NO LABEL"
            
            // Slider setup
            slider.type = "range"
            slider.min = this.getAttribute("min")
            slider.max = this.getAttribute("max")
            slider.step = this.getAttribute("step")
            slider.value = this.getAttribute("value")
            slider.oninput = () => {
                valLabel.innerText = slider.value
                globalThis[`slider_${uuid}`](slider.value)
            }
            
            // Value label setup
            valLabel.setAttribute("for", uuid)
            valLabel.innerText = slider.value

            // Add child nodes
            shadow.appendChild(preLabel)
            shadow.appendChild(slider)
            shadow.appendChild(valLabel)
        }
    }

    class ConfigBuilderCheckbox extends HTMLElement {
        connectedCallback() {
            const uuid = this.getAttribute("uuid")
            const text = this.getAttribute("label")
            if (!uuid) {
                throw new Error("Custom checkbox must have a UUID")
            }
            const label = document.createElement("label")
            const checkbox = document.createElement("input")
            const shadow = this.attachShadow({mode: "closed"})

            // Set this to a block element
            this.style.display = "block"

            // Set up label
            label.setAttribute("for", uuid)
            label.innerText = text
            
            // Set up checkbox
            checkbox.type = "checkbox"
            checkbox.id = uuid
            checkbox.oninput = () => {
                globalThis[`checked_${uuid}`](checkbox.checked)
            }

            // Add child nodes
            shadow.appendChild(label)
            shadow.appendChild(checkbox)
        }
    }

    // This loop waits till the webUI bridge is connected before setting up the custom tags. This lets information
    // be passed back and forth between the program and interface.
    // First waits 250ms, then checks in loops of 10ms (timing took somewhere just below 300ms in testing)
    function waitForWebUI() {
        try {
            if (!webui?.isConnected()) {
                throw new Error()
            }
            globalThis.customElements.define("config-slider", ConfigBuilderSlider)
            globalThis.customElements.define("config-checkbox", ConfigBuilderCheckbox)
        } catch {
            setTimeout(waitForWebUI, 10)
        }
    }
    setTimeout(waitForWebUI, 250)
</script>